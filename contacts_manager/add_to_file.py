import os
from contacts import Contacts

contacts_book = "contacts_book.txt"
def load_contacts_from_file(path: str = contacts_book):
    """–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –∫–æ–Ω—Ç–∞–∫—Ç–∏ –∑ —Ñ–∞–π–ª—É —É Contacts.contacts_list.
       –§–∞–π–ª –æ—á—ñ–∫—É—î —Ñ–æ—Ä–º–∞—Ç: first_name,last_name,email,phone (–ø–æ —Ä—è–¥–∫—É)."""
    Contacts.contacts_list.clear()  # –æ—á–∏—â–∞—î–º–æ —Å–ª–æ–≤–Ω–∏–∫ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ —É –ø–∞–º'—è—Ç—ñ –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
    if not os.path.exists(path):  # –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î —Ñ–∞–π–ª –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–º —à–ª—è—Ö–æ–º
        return  # —è–∫—â–æ —Ñ–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ ‚Äî –≤–∏—Ö–æ–¥–∏–º–æ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó

    # –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —Ñ–∞–π–ª –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —É –∫–æ–¥—É–≤–∞–Ω–Ω—ñ UTF-8
    with open(path, "r", encoding="utf-8") as f:
        for line in f:  # –ø—Ä–æ—Ö–æ–¥–∏–º–æ –ø–æ –∫–æ–∂–Ω–æ–º—É —Ä—è–¥–∫—É —Ñ–∞–π–ª—É
            line = line.strip()  # –≤–∏–¥–∞–ª—è—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ —Å–∏–º–≤–æ–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å—É —Ä—è–¥–∫–∞ —Å–ø–µ—Ä–µ–¥—É —ñ –∑–∑–∞–¥—É
            if not line:  # –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏
                continue
            # —Ä–æ–∑–±–∏–≤–∞—î–º–æ —Ä—è–¥–æ–∫ –Ω–∞ —á–∞—Å—Ç–∏–Ω–∏ –ø–æ –∫–æ–º—ñ —Ç–∞ –æ–±—Ä—ñ–∑–∞—î–º–æ –ø—Ä–æ–±—ñ–ª–∏
            parts = [p.strip() for p in line.split(",")]
            if len(parts) < 4:  # —è–∫—â–æ —Ä—è–¥–æ–∫ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π (–º–µ–Ω—à–µ –Ω—ñ–∂ 4 —á–∞—Å—Ç–∏–Ω–∏) ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ
                continue
            first, last, email, phone = parts[:4]  # —Ä–æ–∑–ø–∞–∫–æ–≤—É—î–º–æ –ø–µ—Ä—à—ñ 4 —á–∞—Å—Ç–∏–Ω–∏
            key = f"{first} {last}"  # —Ñ–æ—Ä–º—É—î–º–æ –∫–ª—é—á –¥–ª—è —Å–ª–æ–≤–Ω–∏–∫–∞ (—ñ–º'—è + –ø—Ä—ñ–∑–≤–∏—â–µ)
            # –¥–æ–¥–∞—î–º–æ –∫–æ–Ω—Ç–∞–∫—Ç —É —Å–ª–æ–≤–Ω–∏–∫ Contacts.contacts_list
            Contacts.contacts_list[key] = {
                "–Ü–º'—è": first,
                "–ü—Ä—ñ–∑–≤–∏—â–µ": last,
                "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞": email,
                "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É": phone
            }


def delete_contact_from_file_by_name(name: str, path: str = "contacts.txt"):
    """–í–∏–¥–∞–ª—è—î –≤—Å—ñ —Ä—è–¥–∫–∏, –¥–µ –∑—É—Å—Ç—Ä—ñ—á–∞—î—Ç—å—Å—è —ñ–º'—è (case-insensitive).
    –ü–æ–≤–µ—Ä—Ç–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–¥–∞–ª–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤."""
    if not os.path.exists(path):
        print("‚ùå –§–∞–π–ª –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.")
        return 0
    # 1. –ó—á–∏—Ç—É—î–º–æ –≤—Å—ñ —Ä—è–¥–∫–∏ –∑ —Ñ–∞–π–ª—É
    with open(path, "r", encoding="utf-8") as f:
        lines = f.readlines()
    # 2. –í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤—É—î–º–æ ‚Äî –∑–∞–ª–∏—à–∞—î–º–æ –ª–∏—à–µ —Ç—ñ, –¥–µ —ñ–º'—è –ù–ï –∑—É—Å—Ç—Ä—ñ—á–∞—î—Ç—å—Å—è
    filtered = [l for l in lines if name.lower() not in l.lower()]
    # 3. –†–∞—Ö—É—î–º–æ, —Å–∫—ñ–ª—å–∫–∏ —Ä—è–¥–∫—ñ–≤ –±—É–ª–æ –≤–∏–¥–∞–ª–µ–Ω–æ
    deleted_count = len(lines) - len(filtered)
    # 4. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ —Ñ–∞–π–ª –±–µ–∑ –≤–∏–¥–∞–ª–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤
    with open(path, "w", encoding="utf-8") as f:
        f.writelines(filtered)
    # 5. –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    if deleted_count > 0:
        print(f"üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–æ {deleted_count} –∫–æ–Ω—Ç–∞–∫—Ç(—ñ–≤) –∑ —ñ–º'—è–º '{name}'.")
    else:
        print(f"‚ÑπÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç –∑ —ñ–º'—è–º '{name}' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.")

    return deleted_count

